<template>
  <div 
    class="center-music-player" 
    v-if="musicConfig && musicConfig.enabled"
    :class="{ 'hidden': !isMusicVisible, 'sliding': isSliding }"
    :style="{
      '--music-bottom': layoutConfig.position.bottom,
      '--music-left': layoutConfig.position.left,
      '--music-transform': layoutConfig.position.transform,
      '--music-width': layoutConfig.size.width,
      '--music-max-width': layoutConfig.size.maxWidth,
      '--card-padding': layoutConfig.card.padding,
      '--card-border-radius': layoutConfig.card.borderRadius,
      '--card-backdrop': layoutConfig.card.backdrop,
      '--card-shadow': layoutConfig.card.shadow,
      '--progress-height': layoutConfig.progressBar?.height || '6px',
      '--progress-radius': layoutConfig.progressBar?.borderRadius || '3px',
      '--progress-bg': layoutConfig.progressBar?.background || 'rgba(255, 255, 255, 0.2)',
      '--progress-fill': layoutConfig.progressBar?.fillColor || '#42b883',
    }"
  >
    <!-- 切换按钮 -->
    <div 
      class="centered-toggle-btn bottom-toggle"
      @click="toggleMusicVisible"
      v-if="!isMusicVisible"
      :title="'显示音乐播放器'"
    >
      <i class="fas fa-chevron-up"></i>
    </div>

    <div class="music-card">
      <!-- 关闭按钮 -->
      <div class="close-music-btn" @click="toggleMusicVisible" title="隐藏音乐播放器">
        <i class="fa-solid fa-chevron-down"></i>
      </div>
      
      <!-- 进度条 (位于顶部) -->
      <div class="progress-container" v-if="musicConfig.showProgressBar" @click="seek" @mousedown="startSeek" @mousemove="onMouseMove" @mouseup="endSeek" @mouseleave="endSeek">
        <div class="progress-bar" :style="{ width: progress + '%' }"></div>
        <div class="progress-handle" :style="{ left: progress + '%' }"></div>
      </div>
      
      <!-- 播放器主体 -->
      <div class="music-player-container">
        <!-- 左侧：封面和信息 -->
        <div class="player-left-section">
          <!-- 封面 -->
          <div class="music-cover" :class="{ 'rotating': isPlaying }">
            <img v-if="currentTrack.cover" :src="currentTrack.cover" :alt="currentTrack.name">
            <div class="default-cover" v-else></div>
          </div>
          
          <!-- 歌曲信息 -->
          <div class="music-info">
            <div class="track-name">{{ currentTrack.name || '未知歌曲' }}</div>
            <div class="track-artist">{{ currentTrack.artist || '未知艺术家' }}</div>
            <div class="time-info">
              <span class="current-time">{{ formatTime(currentTime) }}</span>
              <span class="duration-separator"> / </span>
              <span class="duration">{{ formatTime(duration) }}</span>
            </div>
          </div>
        </div>
        
        <!-- 右侧：控制按钮 -->
        <div class="player-right-section">
          <!-- 控制按钮 -->
          <div class="controls">
            <button class="control-btn" @click="prevTrack" title="上一首">
              <i class="fas fa-step-backward"></i>
            </button>
            <button class="control-btn play-btn" @click="togglePlay" title="播放/暂停">
              <i :class="isPlaying ? 'fas fa-pause' : 'fas fa-play'"></i>
            </button>
            <button class="control-btn" @click="nextTrack" title="下一首">
              <i class="fas fa-step-forward"></i>
            </button>
            <button class="control-btn volume-btn" @click="toggleMute" title="静音/取消静音">
              <i :class="isMuted ? 'fas fa-volume-mute' : 'fas fa-volume-up'"></i>
            </button>
            <div class="volume-slider-container">
              <input
                type="range"
                class="volume-slider"
                min="0"
                max="1"
                step="0.01"
                v-model="volume"
                @input="setVolume"
              >
            </div>
            <button class="control-btn playlist-toggle" @click="togglePlaylist" title="播放列表">
              <i class="fas fa-list"></i>
            </button>
          </div>
        </div>
      </div>
      
      <!-- 播放列表 -->
      <div class="playlist" v-if="musicConfig.showPlaylist && showPlaylist">
        <div class="playlist-header">
          <h4 class="playlist-title">播放列表</h4>
          <button class="close-playlist-btn" @click="togglePlaylist" title="关闭播放列表">
            <i class="fa-solid fa-times"></i>
          </button>
        </div>
        <ul class="playlist-items">
          <li 
            v-for="(track, index) in playlist" 
            :key="index" 
            class="playlist-item"
            :class="{ 'active': currentIndex === index }"
            @click="playTrack(index)"
          >
            <span class="track-index">{{ index + 1 }}</span>
            <div class="track-details">
              <div class="track-name">{{ track.name }}</div>
              <div class="track-artist">{{ track.artist }}</div>
            </div>
            <span class="track-duration">{{ track.duration ? formatTime(track.duration) : '--:--' }}</span>
          </li>
        </ul>
      </div>
    </div>
  </div>
  
  <!-- 实际的音频元素，隐藏 -->
  <audio ref="audio" @timeupdate="onTimeUpdate" @ended="onEnded" @loadedmetadata="onLoaded"></audio>
</template>

<script setup>
import { computed, ref, onMounted, onUnmounted, watch } from 'vue'
import { useData } from 'vitepress'

// 获取VitePress数据和配置
const { theme } = useData()

// 响应式显示相关
const isMusicVisible = ref(true) // 默认显示
const isSliding = ref(false) // 是否正在进行滑动动画
const windowWidth = ref(typeof window !== 'undefined' ? window.innerWidth : 0) // 当前窗口宽度
const showPlaylist = ref(false) // 播放列表显示控制

// 播放器相关
const audio = ref(null) // 音频元素引用
const isPlaying = ref(false)
const isMuted = ref(false)
const volume = ref(0.7)
const currentTime = ref(0)
const duration = ref(0)
const progress = ref(0)
const playlist = ref([])
const currentIndex = ref(0)
const autoplayTimeout = ref(null)

// 进度条拖动相关
const isDragging = ref(false)
const wasPlaying = ref(false)

// 从配置中获取右侧音乐播放器配置
const musicConfig = computed(() => {
  return theme.value.personalHome?.rightComponents?.rightMusicPlayer || null
})

// 从配置中获取布局设置
const layoutConfig = computed(() => {
  return musicConfig.value?.layout || {
    position: { right: '3rem', top: '40%', transform: 'translateY(0)' },
    size: { width: '300px', maxWidth: '300px' },
    card: { padding: '1.5rem', borderRadius: '24px', backdrop: 'blur(20px)', shadow: '0 8px 32px rgba(0, 0, 0, 0.1)' },
    responsive: {
      hideBelow: '1200px'
    }
  }
})

// 当前播放的歌曲
const currentTrack = computed(() => {
  if (!playlist.value.length) return {}
  return playlist.value[currentIndex.value]
})

// 处理音乐播放器显示/隐藏的函数
const toggleMusicVisible = () => {
  isSliding.value = true
  isMusicVisible.value = !isMusicVisible.value
  
  // 添加动画结束后的回调
  setTimeout(() => {
    isSliding.value = false
  }, 600) // 动画持续时间后移除滑动状态，与 CSS transition 保持一致
}

// 切换播放列表显示状态
const togglePlaylist = () => {
  showPlaylist.value = !showPlaylist.value
}

// 进度条拖动相关方法
const startSeek = (e) => {
  if (!audio.value) return
  
  isDragging.value = true
  wasPlaying.value = isPlaying.value
  
  if (isPlaying.value) {
    audio.value.pause()
  }
  
  handleSeek(e)
}

const handleSeek = (e) => {
  if (!isDragging.value) return
  const container = e.currentTarget
  const rect = container.getBoundingClientRect()
  const position = (e.clientX - rect.left) / rect.width
  
  // 确保位置在有效范围内
  const clampedPosition = Math.max(0, Math.min(position, 1))
  progress.value = clampedPosition * 100
  currentTime.value = clampedPosition * duration.value
}

const onMouseMove = (e) => {
  if (isDragging.value) {
    handleSeek(e)
  }
}

const endSeek = () => {
  if (!isDragging.value) return
  
  isDragging.value = false
  if (audio.value) {
    audio.value.currentTime = currentTime.value
    
    if (wasPlaying.value) {
      audio.value.play()
    }
  }
}

// 检查窗口大小
const checkWindowSize = () => {
  if (typeof window === 'undefined') return
  
  windowWidth.value = window.innerWidth
  const breakpointWidth = parseBreakpoint(layoutConfig.value.responsive?.hideBelow || '1200px')
  
  // 根据屏幕大小设置显示状态
  isMusicVisible.value = !(windowWidth.value <= breakpointWidth)
}

// 解析断点字符串
const parseBreakpoint = (breakpoint) => {
  if (!breakpoint) return 1200 // 默认值
  return parseInt(breakpoint.replace(/[^0-9]/g, ''), 10) || 1200
}

// 重置所有交互状态
const resetInteractionStates = () => {
  isSliding.value = false
}

// 格式化时间，将秒数转换为 mm:ss 格式
const formatTime = (seconds) => {
  if (isNaN(seconds) || !isFinite(seconds)) return '00:00'
  const mins = Math.floor(seconds / 60)
  const secs = Math.floor(seconds % 60)
  return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`
}

// 切换播放/暂停
const togglePlay = () => {
  if (!audio.value) return
  
  if (isPlaying.value) {
    audio.value.pause()
    isPlaying.value = false
  } else {
    audio.value.play()
    isPlaying.value = true
  }
}

// 播放指定索引的歌曲
const playTrack = (index) => {
  if (index < 0 || index >= playlist.value.length) return
  
  currentIndex.value = index
  isPlaying.value = false
  
  // 等待下一个 tick 确保音频元素已更新
  setTimeout(() => {
    if (!audio.value) return
    
    audio.value.src = playlist.value[index].url
    audio.value.load()
    
    // 设置音量
    audio.value.volume = isMuted.value ? 0 : volume.value
    
    // 播放
    const playPromise = audio.value.play()
    if (playPromise !== undefined) {
      playPromise.then(_ => {
        isPlaying.value = true
      })
      .catch(error => {
        console.log('Auto-play prevented by browser:', error)
      })
    }
  }, 0)
}

// 下一首
const nextTrack = () => {
  if (!playlist.value.length) return
  const nextIndex = (currentIndex.value + 1) % playlist.value.length
  playTrack(nextIndex)
}

// 上一首
const prevTrack = () => {
  if (!playlist.value.length) return
  const prevIndex = (currentIndex.value - 1 + playlist.value.length) % playlist.value.length
  playTrack(prevIndex)
}

// 切换静音
const toggleMute = () => {
  if (!audio.value) return
  
  isMuted.value = !isMuted.value
  audio.value.muted = isMuted.value
}

// 设置音量
const setVolume = () => {
  if (!audio.value) return
  
  isMuted.value = false
  audio.value.volume = volume.value
  audio.value.muted = false
}

// 跳转到指定位置
const seek = (event) => {
  if (!audio.value || !duration.value) return
  
  const container = event.currentTarget
  const rect = container.getBoundingClientRect()
  const pos = (event.clientX - rect.left) / rect.width
  
  audio.value.currentTime = pos * duration.value
}

// 时间更新事件处理
const onTimeUpdate = () => {
  if (!audio.value) return
  
  currentTime.value = audio.value.currentTime
  if (duration.value) {
    progress.value = (currentTime.value / duration.value) * 100
  }
}

// 歌曲加载完成事件处理
const onLoaded = () => {
  if (!audio.value) return
  
  duration.value = audio.value.duration
}

// 歌曲结束事件处理
const onEnded = () => {
  nextTrack()
}

// 加载歌曲列表
const loadPlaylist = async () => {
  if (!musicConfig.value) return
  
  // 直接加载配置中的播放列表
  if (musicConfig.value.tracks && musicConfig.value.tracks.length) {
    playlist.value = musicConfig.value.tracks.map(track => ({
      name: track.name || '未知歌曲',
      artist: track.artist || '未知艺术家',
      url: track.url,
      cover: track.cover || null
    }))
  } 
  // 从网易云音乐加载歌单
  else if (musicConfig.value.netease && musicConfig.value.netease.playlistId) {
    try {
      // 实际项目中你可能需要替换为真实的API调用
      const playlistId = musicConfig.value.netease.playlistId
      const response = await fetch(`https://api.example.com/netease/playlist?id=${playlistId}`)
      const data = await response.json()
      
      if (data && data.songs) {
        playlist.value = data.songs.map(song => ({
          name: song.name,
          artist: song.ar.map(a => a.name).join(', '),
          url: song.url,
          cover: song.al.picUrl
        }))
      }
    } catch (error) {
      console.error('Failed to load playlist from Netease:', error)
      // 加载失败时使用默认歌曲
      playlist.value = [
        {
          name: '示例歌曲',
          artist: '示例艺术家',
          url: '',
          cover: null
        }
      ]
    }
  }
  
  // 如果配置了自动播放和延时，则设置定时器
  if (musicConfig.value.autoplay && musicConfig.value.autoplayDelay) {
    autoplayTimeout.value = setTimeout(() => {
      if (playlist.value.length > 0) {
        playTrack(0)
      }
    }, musicConfig.value.autoplayDelay * 1000)
  }
}

// 生命周期
onMounted(() => {
  // 重置所有交互状态
  resetInteractionStates()
  
  // 检查初始窗口大小
  checkWindowSize()
  
  // 加载播放列表
  loadPlaylist()
  
  // 添加窗口大小变化事件监听
  window.addEventListener('resize', checkWindowSize)
})

onUnmounted(() => {
  // 停止播放
  if (audio.value) {
    audio.value.pause()
  }
  
  // 清理自动播放定时器
  if (autoplayTimeout.value) {
    clearTimeout(autoplayTimeout.value)
  }
  
  // 移除窗口大小变化事件监听
  window.removeEventListener('resize', checkWindowSize)
})

// 监听窗口大小变化
watch(() => windowWidth.value, (newWidth) => {
  const breakpointWidth = parseBreakpoint(layoutConfig.value.responsive?.hideBelow || '1200px')
  
  // 窗口大小改变时始终调整显示状态
  isMusicVisible.value = !(newWidth <= breakpointWidth)
})
</script>

<style scoped>
.center-music-player {
  position: fixed;
  bottom: var(--music-bottom, 2rem);
  left: var(--music-left, 50%);
  transform: var(--music-transform, translateX(-50%));
  z-index: 100;
  max-width: var(--music-max-width, 90%);
  width: var(--music-width, 600px);
  transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  transform-style: preserve-3d; /* 确保3D变换效果 */
  backface-visibility: hidden; /* 优化平移动画 */
}

/* 隐藏状态 */
.center-music-player.hidden {
  transform: translate(-50%, 100%);
  opacity: 0.3;
}

/* 滑动动画状态 */
.center-music-player.sliding {
  transition: all 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* 底部切换按钮 */
.bottom-toggle {
  position: absolute;
  left: 50%;
  bottom: 100%;
  transform: translateX(-50%);
  width: 60px;
  height: 30px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-bottom: none;
  border-radius: 12px 12px 0 0;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 -5px 15px rgba(0, 0, 0, 0.1);
}

.bottom-toggle:hover {
  background: rgba(255, 255, 255, 0.15);
}

.bottom-toggle i {
  color: rgba(255, 255, 255, 0.9);
  font-size: 1rem;
}

.music-card {
  position: relative;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: var(--card-backdrop, blur(20px));
  border-radius: var(--card-border-radius, 24px);
  padding: var(--card-padding, 1.5rem);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: all 0.3s ease;
  box-shadow: var(--card-shadow, 0 8px 32px rgba(0, 0, 0, 0.1));
  overflow: hidden;
}

.music-card:hover {
  background: rgba(255, 255, 255, 0.15);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
}

.music-player-container {
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem 0;
}

.music-cover {
  width: 60px;
  height: 60px;
  border-radius: 10px;
  overflow: hidden;
  margin-right: 1rem;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
  transition: transform 0.3s ease;
  flex-shrink: 0;
}

.music-cover img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  border-radius: 10px;
}

.music-cover.rotating {
  animation: rotate 10s linear infinite;
}

.default-cover {
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #42b883 0%, #35495e 100%);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1.5rem;
}

.default-cover::after {
  content: '♪';
}

.music-info {
  display: flex;
  flex-direction: column;
  justify-content: center;
  flex: 1;
  min-width: 0; /* 防止溢出 */
}

.track-name {
  font-size: 1rem;
  font-weight: 600;
  color: rgba(255, 255, 255, 0.9);
  margin-bottom: 0.2rem;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.track-artist {
  font-size: 0.85rem;
  color: rgba(255, 255, 255, 0.7);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-bottom: 0.2rem;
}

.time-info {
  display: flex;
  font-size: 0.75rem;
  color: rgba(255, 255, 255, 0.6);
}

.duration-separator {
  margin: 0 3px;
}

.player-left-section {
  display: flex;
  align-items: center;
  flex: 1;
  min-width: 0; /* 防止溢出 */
}

.player-right-section {
  display: flex;
  align-items: center;
  justify-content: flex-end;
  margin-left: 1rem;
}

.progress-container {
  width: 100%;
  height: var(--progress-height, 6px);
  background: var(--progress-bg, rgba(255, 255, 255, 0.2));
  border-radius: var(--progress-radius, 3px);
  cursor: pointer;
  overflow: visible;
  margin-bottom: 0.5rem;
  position: relative;
  margin-top: -1px; /* 让进度条紧贴顶部 */
  transition: height 0.3s ease;
}

.progress-container:hover {
  height: calc(var(--progress-height, 6px) * 1.5);
}

.progress-bar {
  height: 100%;
  background: linear-gradient(90deg, var(--progress-fill, #42b883) 0%, #35495e 100%);
  border-radius: var(--progress-radius, 3px);
  position: relative;
}

.progress-handle {
  position: absolute;
  width: 12px;
  height: 12px;
  background: white;
  border-radius: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
  opacity: 0;
  transition: opacity 0.2s ease;
}

.progress-container:hover .progress-handle {
  opacity: 1;
}

.controls {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 0.75rem;
}

.control-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
}

.control-btn {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  border: none;
  cursor: pointer;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.control-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: scale(1.1);
}

.control-btn i {
  color: rgba(255, 255, 255, 0.9);
  font-size: 0.9rem;
}

.play-btn {
  width: 44px;
  height: 44px;
  background: rgba(66, 184, 131, 0.3);
}

.play-btn:hover {
  background: rgba(66, 184, 131, 0.5);
}

.play-btn i {
  font-size: 1.1rem;
}

.volume-btn {
  position: relative;
}

.volume-slider-container {
  width: 80px;
  padding: 0 0.5rem;
  display: flex;
  align-items: center;
}

.volume-slider {
  -webkit-appearance: none;
  appearance: none;
  width: 100%;
  height: 4px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 2px;
  outline: none;
  cursor: pointer;
}

.volume-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #42b883;
  cursor: pointer;
}

.volume-slider::-moz-range-thumb {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  background: #42b883;
  cursor: pointer;
}

.playlist {
  position: absolute;
  top: 100%;
  left: 0;
  right: 0;
  background: rgba(30, 30, 30, 0.9);
  backdrop-filter: blur(20px);
  border-radius: 0 0 24px 24px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  padding: 1rem;
  margin-top: 0;
  z-index: 10;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
  max-height: 300px;
  overflow-y: auto;
  animation: slideDown 0.3s ease;
}

.playlist-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 0.75rem;
}

.playlist-title {
  font-size: 1.1rem;
  font-weight: 600;
  margin: 0;
  color: rgba(255, 255, 255, 0.8);
}

.close-playlist-btn {
  background: transparent;
  border: none;
  color: rgba(255, 255, 255, 0.7);
  cursor: pointer;
  font-size: 1rem;
  padding: 5px;
  transition: all 0.2s ease;
}

.close-playlist-btn:hover {
  color: rgba(255, 255, 255, 1);
}

.playlist-items {
  list-style: none;
  padding: 0;
  margin: 0;
  max-height: 200px;
  overflow-y: auto;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.05);
}

.playlist-item {
  padding: 0.75rem;
  display: flex;
  align-items: center;
  gap: 0.75rem;
  cursor: pointer;
  transition: background-color 0.2s;
  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.playlist-item:last-child {
  border-bottom: none;
}

.playlist-item:hover {
  background: rgba(255, 255, 255, 0.1);
}

.playlist-item.active {
  background: rgba(66, 184, 131, 0.2);
}

.track-index {
  font-size: 0.9rem;
  color: rgba(255, 255, 255, 0.6);
  width: 20px;
  text-align: center;
}

.track-details {
  flex: 1;
  min-width: 0;
}

.track-details .track-name {
  font-size: 0.95rem;
  margin-bottom: 0.1rem;
}

.track-details .track-artist {
  font-size: 0.8rem;
}

.track-duration {
  font-size: 0.8rem;
  color: rgba(255, 255, 255, 0.6);
}

/* 右侧切换按钮样式 */
.right-toggle {
  right: 0;
  left: auto;
  border-radius: 12px 0 0 12px;
  border-right: none;
}

/* 切换按钮样式 */
.centered-toggle-btn {
  position: fixed;
  top: 50%;
  transform: translateY(-50%);
  width: 32px;
  height: 60px;
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 101;
  transition: all 0.3s ease, background-color 0.2s;
  box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.1);
  overflow: hidden;
}

.centered-toggle-btn::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 50%);
  opacity: 0;
  transition: opacity 0.3s;
}

.centered-toggle-btn:hover {
  background: rgba(255, 255, 255, 0.15);
  box-shadow: 2px 2px 15px rgba(0, 0, 0, 0.15);
}

.centered-toggle-btn:hover::before {
  opacity: 1;
}

.centered-toggle-btn:active {
  transform: translateY(-50%) scale(0.95);
}

.centered-toggle-btn i {
  color: rgba(255, 255, 255, 0.8);
  font-size: 0.9rem;
  transition: transform 0.3s;
}

.centered-toggle-btn:hover i {
  transform: scale(1.2);
  color: rgba(255, 255, 255, 1);
}

/* 右上角关闭按钮样式 */
.close-music-btn {
  position: absolute;
  top: 12px;
  right: 12px;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s ease;
  z-index: 5;
}

.close-music-btn:hover {
  background: rgba(255, 255, 255, 0.2);
  transform: rotate(-180deg);
}

.close-music-btn i {
  color: rgba(255, 255, 255, 0.8);
  font-size: 0.9rem;
}

.close-music-btn:hover i {
  color: rgba(255, 255, 255, 1);
}

/* 隐藏状态 - 向右平移出视图 */
.right-music-player.hidden {
  transform: translateX(120%) translateY(0) !important; /* 使用正百分比确保完全移出视图 */
  pointer-events: none; /* 隐藏时禁用交互 */
  opacity: 1; /* 保持不透明度，专注于平移效果 */
}

/* 滑动动画时的状态 */
.right-music-player.sliding {
  will-change: transform; /* 优化平移动画性能 */
}

/* 为响应式布局添加过渡效果 */
.right-music-player {
  transition: transform 0.6s cubic-bezier(0.25, 0.1, 0.25, 1); /* 使用平滑的缓动函数 */
  transform-origin: right center; /* 确保从右侧开始变换 */
  will-change: transform; /* 优化平移性能 */
}

/* 封面旋转动画 */
@keyframes rotate {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* VitePress 暗色模式样式 */
html.dark .center-music-player {
  .music-card {
    background: rgba(30, 30, 30, 0.8);
    border-color: rgba(255, 255, 255, 0.1);
  }
  
  .music-card:hover {
    background: rgba(30, 30, 30, 0.9);
  }
  
  .music-title {
    color: #42b883;
  }
  
  .track-name, .track-artist {
    color: rgba(255, 255, 255, 0.8);
  }
  
  .progress-container {
    background: rgba(255, 255, 255, 0.1);
  }
  
  .control-btn {
    background: rgba(30, 30, 30, 0.8);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
  
  .control-btn:hover {
    background: rgba(40, 40, 40, 0.9);
  }
  
  .play-btn {
    background: rgba(66, 184, 131, 0.2);
  }
  
  .play-btn:hover {
    background: rgba(66, 184, 131, 0.4);
  }
  
  .volume-slider {
    background: rgba(255, 255, 255, 0.1);
  }
  
  .playlist-items {
    background: rgba(20, 20, 20, 0.5);
  }
  
  .playlist-item:hover {
    background: rgba(40, 40, 40, 0.8);
  }
  
  .playlist-item.active {
    background: rgba(66, 184, 131, 0.2);
  }
  
  .centered-toggle-btn {
    background: rgba(30, 30, 30, 0.8);
    border-color: rgba(255, 255, 255, 0.1);
    box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.25);
  }
  
  .centered-toggle-btn::before {
    background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0) 50%);
  }
  
  .centered-toggle-btn:hover {
    background: rgba(40, 40, 40, 0.9);
    box-shadow: 2px 2px 15px rgba(0, 0, 0, 0.3);
    border-color: rgba(255, 255, 255, 0.15);
  }
  
  .centered-toggle-btn i {
    color: rgba(255, 255, 255, 0.8);
  }
  
  .centered-toggle-btn:hover i {
    color: #42b883; /* 使用与网站主题一致的绿色 */
  }
  
  .close-music-btn {
    background: rgba(30, 30, 30, 0.7);
    border-color: rgba(255, 255, 255, 0.1);
  }
  
  .close-music-btn:hover {
    background: rgba(40, 40, 40, 0.9);
    border-color: rgba(255, 255, 255, 0.2);
  }
  
  .close-music-btn i {
    color: rgba(255, 255, 255, 0.7);
  }
  
  .close-music-btn:hover i {
    color: #42b883; /* 与网站主题一致的绿色 */
  }
}

/* 移动设备适配样式 */
@media (max-width: 768px) {
  .bottom-toggle {
    width: 80px; /* 移动设备上增加按钮宽度，便于触摸 */
    height: 30px;
  }
  
  .bottom-toggle i {
    font-size: 1.1rem;
  }
  
  /* 移动设备上调整滑动距离和动画速度 */
  .center-music-player.hidden {
    transform: translate(-50%, 120%) !important; /* 移动设备上滑动更远，确保完全离开视图 */
  }
  
  .center-music-player {
    transition: all 0.5s cubic-bezier(0.25, 0.1, 0.25, 1); /* 移动设备上使用适当的动画速度 */
    width: 95%;
  }
  
  /* 移动设备上增大关闭按钮 */
  .close-music-btn {
    width: 38px;
    height: 38px;
    top: 10px;
    right: 10px;
  }
  
  .close-music-btn i {
    font-size: 1rem;
  }
  
  /* 移动设备上调整控制按钮大小 */
  .control-btn {
    width: 32px;
    height: 32px;
  }
  
  .play-btn {
    width: 40px;
    height: 40px;
  }
}
</style>
